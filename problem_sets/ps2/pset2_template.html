<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emma Brady">
<meta name="dcterms.date" content="2024-10-19">

<title>30538 Problem Set 2: Parking Tickets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="pset2_template_files/libs/clipboard/clipboard.min.js"></script>
<script src="pset2_template_files/libs/quarto-html/quarto.js"></script>
<script src="pset2_template_files/libs/quarto-html/popper.min.js"></script>
<script src="pset2_template_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pset2_template_files/libs/quarto-html/anchor.min.js"></script>
<link href="pset2_template_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pset2_template_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pset2_template_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pset2_template_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pset2_template_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="pset2_template_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="pset2_template_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="pset2_template_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">30538 Problem Set 2: Parking Tickets</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emma Brady </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<ol type="1">
<li>“This submission is my work alone and complies with the 30538 integrity policy.” Add your initials to indicate your agreement: EB</li>
<li>“I have uploaded the names of anyone I worked with on the problem set <strong><a href="https://docs.google.com/forms/d/1-zzHx762odGlpVWtgdIC55vqF-j3gqdAp6Pno1rIGK0/edit">here</a></strong>” EB (1 point)</li>
<li>Late coins used this pset: 1 Late coins left after submission: 2</li>
<li>Knit your <code>ps2.qmd</code> to make <code>ps2.pdf</code>.
<ul>
<li>The PDF should not be more than 25 pages. Use <code>head()</code> and re-size figures when appropriate.</li>
</ul></li>
<li>Push <code>ps2.qmd</code> and <code>ps2.pdf</code> to your github repo. It is fine to use Github Desktop.</li>
<li>Submit <code>ps2.pdf</code> via Gradescope (4 points)</li>
<li>Tag your submission in Gradescope</li>
</ol>
<div id="c82c2ee5" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>alt.renderers.enable(<span class="st">"png"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-cleaning-continued-15-points" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-continued-15-points">Data cleaning continued (15 points)</h2>
<ol type="1">
<li>Read csv file</li>
</ol>
<div id="9285ee44" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/parking_tickets_one_percent.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="33c955cb" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Function that creates a new dataframe with variables and NA Count</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> na_function(df):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""create a data frame with variables and NA count"""</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    count_na <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Variable'</span>: df.columns,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'NA'</span>: df.isna().<span class="bu">sum</span>()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> count_na</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4c2751ef" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Testing out the function</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">##Creating test dataframe</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'test1'</span>: [<span class="va">None</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'test2'</span>: [<span class="dv">2</span>, <span class="va">None</span>, <span class="dv">2</span>, <span class="va">None</span>, <span class="dv">2</span>],</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'test3'</span>: [<span class="dv">3</span>, <span class="dv">3</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span>],</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'test4'</span>: [<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">##testing the function on the test dataframe</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>testing_na <span class="op">=</span> na_function(test_df)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(testing_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Variable  NA
test1    test1   1
test2    test2   2
test3    test3   3
test4    test4   0</code></pre>
</div>
</div>
<div id="fee88a37" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the function on the parking tickets data frame</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>parking_tickets_na <span class="op">=</span> na_function(df)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(parking_tickets_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                    Variable      NA
Unnamed: 0                        Unnamed: 0       0
ticket_number                  ticket_number       0
issue_date                        issue_date       0
violation_location        violation_location       0
license_plate_number    license_plate_number       0
license_plate_state      license_plate_state      97
license_plate_type        license_plate_type    2054
zipcode                              zipcode   54115
violation_code                violation_code       0
violation_description  violation_description       0
unit                                    unit      29
unit_description            unit_description       0
vehicle_make                    vehicle_make       0
fine_level1_amount        fine_level1_amount       0
fine_level2_amount        fine_level2_amount       0
current_amount_due        current_amount_due       0
total_payments                total_payments       0
ticket_queue                    ticket_queue       0
ticket_queue_date          ticket_queue_date       0
notice_level                    notice_level   84068
hearing_disposition      hearing_disposition  259899
notice_number                  notice_number       0
officer                              officer       0
address                              address       0</code></pre>
</div>
</div>
<p>Referred to the following webpages: https://saturncloud.io/blog/how-to-count-nan-values-in-a-pandas-dataframe-column/ https://www.geeksforgeeks.org/different-ways-to-create-pandas-dataframe/ https://stackoverflow.com/questions/45579525/returning-a-dataframe-in-python-function</p>
<ol start="2" type="1">
<li>notice_level, hearing_disposition, and zipcode are missing more often than others.</li>
</ol>
<p>Notice level is missing often because if the field is blank no notice was sent. All the NAs indicate that no notice was sent.</p>
<p>While hearing disposition is not defined in the data dictionary, it may refer to whether there was a hearing disposition for the ticket, and the NAs may indicate that there wasn’t.</p>
<p>Zipcode refers to the ZIPcode associated with the vehicle registration, and if the ticket is associated to a lack of vehicle registration than there will be an NA there.</p>
<ol start="3" type="1">
<li></li>
</ol>
<div id="37bbccda" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Create a function that gives the corresponding value in the 'violation_code' column </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">##for any value in the 'violation_description' that contains the words "city sticker"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> city_sticker_function(df):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    sticker_violation <span class="op">=</span> df[df[<span class="st">'violation_description'</span>].<span class="bu">str</span>.contains(<span class="st">'NO CITY STICKER'</span>)]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sticker_violation[<span class="st">'violation_code'</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>city_sticker_violation_codes <span class="op">=</span> city_sticker_function(df).unique()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(city_sticker_violation_codes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['0964125' '0976170' '0964125B' '0964125C']</code></pre>
</div>
</div>
<div id="e81dc951" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">##check that each code pulled is for no city sticker</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'violation_description'</span>].loc[df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0964125'</span>].unique())</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'violation_description'</span>].loc[df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0976170'</span>].unique())</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'violation_description'</span>].loc[df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0964125B'</span>].unique())</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'violation_description'</span>].loc[df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0964125C'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['NO CITY STICKER OR IMPROPER DISPLAY']
['NO CITY STICKER OR IMPROPER DISPLAY']
['NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 LBS.']
['NO CITY STICKER VEHICLE OVER 16,000 LBS.']</code></pre>
</div>
</div>
<p>The original violation code was 0964125 and the new violation code is 0976170. Violation codes also included 0964125B for no city sticker on vehicles under/equal to 16,000 lbs and 0964125C for no city sticker on vehicles over 16,000 lbs.</p>
<ol start="4" type="1">
<li></li>
</ol>
<div id="d83553a0" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'fine_level1_amount'</span>].loc[df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0964125'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[120]</code></pre>
</div>
</div>
<p>The cost of an initial offense for violation code 0964125 is $120</p>
<div id="e0fd9a49" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'fine_level1_amount'</span>].loc[df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0976170'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[120]</code></pre>
</div>
</div>
<p>The cost of an initial offense for violation code 0976170 is $120</p>
<div id="187b1ffa" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'fine_level1_amount'</span>].loc[df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0964125B'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[200]</code></pre>
</div>
</div>
<p>The cost of an initial offense for violation code 0964125B is $200.</p>
</section>
<section id="revenue-increase-from-missing-city-sticker-tickets-20-points" class="level2">
<h2 class="anchored" data-anchor-id="revenue-increase-from-missing-city-sticker-tickets-20-points">Revenue increase from “missing city sticker” tickets (20 Points)</h2>
<ol type="1">
<li></li>
</ol>
<div id="4b527acf" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a new value for violation codes which combines the two city sticker violation codes.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'violation_code'</span>] <span class="op">=</span> df[<span class="st">'violation_code'</span>].replace(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'0964125'</span>, <span class="st">'0976170'</span>, <span class="st">'0964125B'</span>], <span class="st">'1111111'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ddbad61b" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Collapse the data to capture the number of missing city sticker tickets by month.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'issue_date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'issue_date'</span>])</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'1111111'</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>filtered_df[<span class="st">'month'</span>] <span class="op">=</span> filtered_df[<span class="st">'issue_date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>stickers_by_month <span class="op">=</span> filtered_df.groupby(<span class="st">'month'</span>)[<span class="st">'violation_code'</span>].count().reset_index()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>stickers_by_month[<span class="st">'month'</span>] <span class="op">=</span> stickers_by_month[<span class="st">'month'</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7a26bce3" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Use Altair to plot the number of tickets over time</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sticker_violations_by_month_chart <span class="op">=</span> alt.Chart(stickers_by_month).mark_line().encode(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'month:O'</span>, title<span class="op">=</span><span class="st">'Issue Month'</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'violation_code:Q'</span>, title<span class="op">=</span><span class="st">'City Sticker Violations'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>sticker_violations_by_month_chart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-14-output-1.png" width="2789" height="374" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Referred to the following page: https://www.statology.org/pandas-group-by-month/</p>
<ol start="2" type="1">
<li></li>
<li></li>
</ol>
<div id="0c6a3a72" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>violations_2011 <span class="op">=</span> df[(df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'1111111'</span>) <span class="op">&amp;</span> (df[<span class="st">'issue_date'</span>].dt.year <span class="op">==</span> <span class="dv">2011</span>)]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>violations_2011.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>1935</code></pre>
</div>
</div>
<p>In this 1% sample of the data, there were 1935 sticker violation tickets in 2011, implying that there were roughly 193,500 total sticker violations. With an $80 increase in the ticket charge, the city would raise revenue by $15,480,000.</p>
<ol start="4" type="1">
<li></li>
</ol>
<div id="5f75e331" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate total number of no city sticker violations in 2011</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>violations_2011 <span class="op">=</span> df[(df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'1111111'</span>) <span class="op">&amp;</span> (df[<span class="st">'issue_date'</span>].dt.year <span class="op">==</span> <span class="dv">2011</span>)]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>violations_2011.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>1935</code></pre>
</div>
</div>
<div id="2c2afd1e" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate paid number of no city sticker violations in 2011</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>violations_2011_unpaid <span class="op">=</span> df[</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    (df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'1111111'</span>) <span class="op">&amp;</span> (df[<span class="st">'issue_date'</span>].dt.year <span class="op">==</span> <span class="dv">2011</span>) <span class="op">&amp;</span> (df[<span class="st">'ticket_queue'</span>] <span class="op">==</span> <span class="st">'Paid'</span>)]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>violations_2011_unpaid.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>1044</code></pre>
</div>
</div>
<p>There were 1935 no sticker violation tickets issued in this sample set in 2011 and 1044 were paid, so there waas a repayment rate of 54%.</p>
<div id="c96acadd" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate total number of no city sticker violations in 2012</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>violations_2012 <span class="op">=</span> df[(df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'1111111'</span>) <span class="op">&amp;</span> (df[<span class="st">'issue_date'</span>].dt.year <span class="op">==</span> <span class="dv">2012</span>)]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>violations_2012.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>2192</code></pre>
</div>
</div>
<div id="35ec26fb" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate paid number of no city sticker violations in 2012</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>violations_2012_unpaid <span class="op">=</span> df[</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    (df[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'1111111'</span>) <span class="op">&amp;</span> (df[<span class="st">'issue_date'</span>].dt.year <span class="op">==</span> <span class="dv">2012</span>) <span class="op">&amp;</span> (df[<span class="st">'ticket_queue'</span>] <span class="op">==</span> <span class="st">'Paid'</span>)]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>violations_2012_unpaid.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>1057</code></pre>
</div>
</div>
<p>There were 2192 no sticker violation tickets issued in this sample set in 2012 and 1057 were paid, so there was a repayment rate decreased to 48%.</p>
<p>If the number of tickets issues was unchanged after the price increase and we only calculated changes based on the new and old repayment rates, the revenue in 2011 would be: 193,500 x 120 = 23,220,000 23,220,00 x 54% repayment rate = $12,538,800</p>
<p>And assuming the same number of tickets are issued in 2012, with the only changes being the price increasing and the repayment rate decreasing, the revenue in 2012 would be: 193,500 x 200 = 38,700,000 38,700,000 x 48% repayment rate = $18,576,000</p>
<p>The increase in revenue from 2011 to 2012 with raising the ticket cost to $200 and the repayment rate decreasing 4 percentage point would only be $6,037,200.</p>
<ol start="5" type="1">
<li></li>
</ol>
<div id="425a7d0d" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Create a new column to find rate of paid ticket</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>filtered_df[<span class="st">'paid'</span>] <span class="op">=</span> filtered_df[<span class="st">'ticket_queue'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'Paid'</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">##group by year</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>yearly_df <span class="op">=</span> filtered_df.groupby(filtered_df[<span class="st">'issue_date'</span>].dt.year).agg(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    repayment_rate<span class="op">=</span>(<span class="st">'paid'</span>, <span class="st">'mean'</span>)).reset_index()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(yearly_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    issue_date  repayment_rate
0         2007        0.550859
1         2008        0.578852
2         2009        0.531134
3         2010        0.519879
4         2011        0.539535
5         2012        0.482208
6         2013        0.405921
7         2014        0.384198
8         2015        0.406161
9         2016        0.407686
10        2017        0.370124
11        2018        0.201449</code></pre>
</div>
</div>
<div id="95dd6b82" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> alt.Chart(yearly_df).mark_line().encode(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'issue_date:N'</span>, title<span class="op">=</span><span class="st">'Issue Year'</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'repayment_rate:Q'</span>, title<span class="op">=</span><span class="st">'Repayment Rate'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>rules <span class="op">=</span> alt.Chart(pd.DataFrame({</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Date'</span>: [<span class="dv">2012</span>]})</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>).mark_rule(color<span class="op">=</span><span class="st">'red'</span>).encode(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'Date:O'</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>(lines <span class="op">+</span> rules)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-21-output-1.png" width="286" height="360" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>While the repayment rate was already on downward trajectory, with the introduction of the new policy in 2012 the repayment rate continued to delcine from approximately 52% in 2011 all the way down to approximately 20% in 2018.</p>
<ol start="6" type="1">
<li></li>
</ol>
<div id="c2202744" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">##create a new column to calculate repayment rate</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'paid'</span>] <span class="op">=</span> df[<span class="st">'ticket_queue'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'Paid'</span> <span class="cf">else</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="15aabfcb" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">##subset data to just pre-policy implemenation yeat</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df_before_2012 <span class="op">=</span> df[df[<span class="st">'issue_date'</span>].dt.year <span class="op">&lt;</span> <span class="dv">2012</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cd224bf1" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">##find the violation codes that are issued most often</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df_before_2012[<span class="st">'violation_code'</span>].value_counts().head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>violation_code
0976160F    21906
0964190     18117
0964040B    14740
0964090E    11452
1111111     10558
0964150B     9673
0976160A     8339
0964080A     7121
0964190A     3503
0964080B     3435
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="5d6547c8" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">##calculating repayment rate for violation code 0976160F</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>rate_1_test <span class="op">=</span> df_before_2012[df_before_2012[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0976160F'</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rate_1_test[<span class="st">'paid'</span>].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.6078699899570894</code></pre>
</div>
</div>
<div id="043ddf09" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">##calculating total number of paid tickets for violation code 0976160F</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>rate_1_test[<span class="st">'paid'</span>].<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>np.int64(13316)</code></pre>
</div>
</div>
<p>Number of tickets given for violation code 0976160F: 21906</p>
<p>Repayment rate for violation code 0976160F: 61%</p>
<p>Number of tickets paid: 13316</p>
<div id="d715abcd" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>rate_2_test <span class="op">=</span> df_before_2012[df_before_2012[<span class="st">'violation_code'</span>] <span class="op">==</span> <span class="st">'0964190'</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rate_2_test[<span class="st">'paid'</span>].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8047690014903129</code></pre>
</div>
</div>
<div id="56db91f8" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>rate_2_test[<span class="st">'paid'</span>].<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>np.int64(14580)</code></pre>
</div>
</div>
<p>Number of tickets given for violation code 0964190: 18117</p>
<p>Repayment rate for violation code 0976160F: 80%</p>
<p>Number of tickets paid: 14580</p>
<div id="71fc70a6" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">##filter the df to only contain the top 10 most frequently given tickets</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>top_10_tickets <span class="op">=</span> [</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'0976160F'</span>, <span class="st">'0964190'</span>, <span class="st">'0964040B'</span>, <span class="st">'0964090E'</span>, <span class="st">'1111111'</span>, <span class="st">'0964150B'</span>, <span class="st">'0976160A'</span>, <span class="st">'0964080A'</span>, <span class="st">'0964190A'</span>, <span class="st">'0964080B'</span>]</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>most_frequent_tickets_df <span class="op">=</span> df_before_2012[</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    df_before_2012[<span class="st">'violation_code'</span>].isin(top_10_tickets)]</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co">##group by 'violation_code' and sum the 'paid' column to get the total count of paid tickets</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>grouped_by_code_df <span class="op">=</span> most_frequent_tickets_df.groupby(</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'violation_code'</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">'paid'</span>].<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c349a8a5" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Create the bar chart in Altair</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>q_2_6_chart <span class="op">=</span> alt.Chart(grouped_by_code_df).mark_bar().encode(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'violation_code:N'</span>, title<span class="op">=</span><span class="st">'Violation Code'</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'paid:Q'</span>, title<span class="op">=</span><span class="st">'Total Paid Tickets'</span>),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_code'</span>, <span class="st">'paid'</span>]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Total Paid Tickets for Each Violation Code"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>q_2_6_chart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-30-output-1.png" width="293" height="400" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Based on the number of paid tickets by violation types before 2012, if the city raised the price for each ticket by the same amount (say by $80 as it was raised for the no city sticker violation) and wanted to raise the highest number of revenue, by looking at this chart we can see that they should increase the price of violation codes 0964190, 0976160F, and 0964040B.</p>
</section>
<section id="headlines-and-sub-messages-20-points" class="level2">
<h2 class="anchored" data-anchor-id="headlines-and-sub-messages-20-points">Headlines and sub-messages (20 points)</h2>
<ol type="1">
<li></li>
</ol>
<div id="d6a11226" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">##create new dataframe grouped by violation description and aggregated by other factors</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>q_3_1_df <span class="op">=</span> df.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    paid_tickets<span class="op">=</span>(<span class="st">'paid'</span>, <span class="st">'mean'</span>),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    avg_level1_fine<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    ticket_count<span class="op">=</span>(<span class="st">'ticket_number'</span>, <span class="st">'count'</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">##sort dataframe by ticket count</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>q_3_1_df <span class="op">=</span> q_3_1_df.sort_values(by<span class="op">=</span>[<span class="st">'ticket_count'</span>], ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a1f9f9ea" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q_3_1_df.head(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        violation_description  paid_tickets  avg_level1_fine  \
23   EXPIRED PLATES OR TEMPORARY REGISTRATION      0.604361        54.968869   
101                           STREET CLEANING      0.811612        54.004249   
90                 RESIDENTIAL PERMIT PARKING      0.742262        66.338302   
19   EXP. METER NON-CENTRAL BUSINESS DISTRICT      0.792913        46.598058   
81        PARKING/STANDING PROHIBITED ANYTIME      0.705817        66.142864   

     ticket_count  
23          44811  
101         28712  
90          23683  
19          20600  
81          19753  </code></pre>
</div>
</div>
<p>Referred to the following pages: https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.aggregate.html https://www.geeksforgeeks.org/how-to-sort-pandas-dataframe/</p>
<ol start="2" type="1">
<li></li>
</ol>
<div id="733275c2" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#filter the dataframe to only contain violations that appear at least 100 times</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>at_least_100_df <span class="op">=</span> q_3_1_df[q_3_1_df[<span class="st">'ticket_count'</span>] <span class="op">&gt;=</span> <span class="dv">100</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c5fa0449" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">##make a scatterplot in Altair</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>chart_1 <span class="op">=</span> alt.Chart(q_3_1_df).mark_point(clip<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'paid_tickets'</span>, title<span class="op">=</span><span class="st">'Fraction of Tickets that Are Paid'</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'avg_level1_fine'</span>, title<span class="op">=</span><span class="st">'Average Level 1 Fine'</span>).scale(domain<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">275</span>))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>chart_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-34-output-1.png" width="350" height="342" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The main message one would take away from this plot is that there looks to be a normal distrubtion around the fraction of tickets that are paid in relation to the fine amount. There is slightly more crowding of the data between tickets are are paid 50-70% of the time and have a fine level of $25-$75.</p>
<div id="6d2e6ebe" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>chart_2 <span class="op">=</span> alt.Chart(q_3_1_df).mark_point(clip<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'paid_tickets'</span>, title<span class="op">=</span><span class="st">'Fraction of Tickets that Are Paid'</span>),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'avg_level1_fine'</span>, title<span class="op">=</span><span class="st">'Average Level 1 Fine'</span>).scale(domain<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">275</span>)),</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    alt.Size(<span class="st">'ticket_count:Q'</span>, title<span class="op">=</span><span class="st">'Ticket Count'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>chart_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-35-output-1.png" width="434" height="342" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In addition to what we gathered from the last chart, in this chart we can also see that there is the highest count of tickets given out that are approximately $50-$60 and they are paid back around 50%-80% of the time.</p>
<div id="403cbb41" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>chart_3 <span class="op">=</span> alt.Chart(q_3_1_df).mark_circle(clip<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'paid_tickets:Q'</span>, <span class="bu">bin</span><span class="op">=</span>alt.BinParams(maxbins<span class="op">=</span><span class="dv">20</span>), </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Fraction of Tickets that Are Paid:Q'</span>),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'avg_level1_fine'</span>, <span class="bu">bin</span><span class="op">=</span>alt.BinParams(maxbins<span class="op">=</span><span class="dv">20</span>), </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Average Level 1 Fine'</span>).scale(domain<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">300</span>)),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    alt.Size(<span class="st">'count()'</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>chart_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-36-output-1.png" width="460" height="347" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This chart simplifies the other charts and brings the eye to notice that tickets are most often paid back when they are $25-$75. It deemphasizes the fines that are $175 or more, as it appears in this chart that they are rarely given out.</p>
<p>Referred to the following: https://altair-viz.github.io/user_guide/customization.html</p>
<ol start="3" type="1">
<li>I am going to bring the City Clerk the third chart because it simplifies the data the most and brings your attention to the fact that tickets are most often paid when they are $25-$75.</li>
</ol>
</section>
<section id="understanding-the-structure-of-the-data-and-summarizing-it-lecture-5-20-points" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-structure-of-the-data-and-summarizing-it-lecture-5-20-points">Understanding the structure of the data and summarizing it (Lecture 5, 20 Points)</h2>
<ol type="1">
<li></li>
</ol>
<div id="c1fb7208" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>q_4_df <span class="op">=</span> df.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    avg_level1_fine<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    avg_level2_fine<span class="op">=</span>(<span class="st">'fine_level2_amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    ticket_count<span class="op">=</span>(<span class="st">'ticket_number'</span>, <span class="st">'count'</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">##create a new column that shows if fines double in price if unpaid</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>q_4_df[<span class="st">'does_it_double'</span>] <span class="op">=</span> q_4_df[<span class="st">'avg_level2_fine'</span>] <span class="op">/</span> q_4_df[<span class="st">'avg_level1_fine'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d5d85809" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">##find the rows where the violaiton code does not double</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q_4_df[(q_4_df[<span class="st">'does_it_double'</span>] <span class="op">&lt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> (q_4_df[<span class="st">'ticket_count'</span>] <span class="op">&gt;</span> <span class="dv">100</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       violation_description  avg_level1_fine  \
5       BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE       141.592780   
15                     DISABLED PARKING ZONE       216.986234   
42  NO CITY STICKER VEHICLE OVER 16,000 LBS.       500.000000   
54   OBSTRUCTED OR IMPROPERLY TINTED WINDOWS       156.180812   
62                       PARK OR BLOCK ALLEY       150.000000   
79                PARK/STAND ON BICYCLE PATH       143.432203   
95     SMOKED/TINTED WINDOWS PARKED/STANDING       151.090159   

    avg_level2_fine  ticket_count  does_it_double  
5        266.751108          1579        1.883932  
15       358.308751          2034        1.651297  
42       955.343511           131        1.910687  
54       225.645756           271        1.444773  
62       259.926829          2050        1.732846  
79       278.601695           236        1.942393  
95       209.516794          1697        1.386700  </code></pre>
</div>
</div>
<p>The following violations have at least 100 citations and do not double. Each increases by the following:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Violation</th>
<th>Increase Amount</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Block access/alley/driveway/firelane</td>
<td>1.88</td>
</tr>
<tr class="even">
<td>Disabled parking zone</td>
<td>1.65</td>
</tr>
<tr class="odd">
<td>No city sticker vehicle over 16,000 lbs.</td>
<td>1.91</td>
</tr>
<tr class="even">
<td>Obstructed or improperly tinted windows</td>
<td>1.44</td>
</tr>
<tr class="odd">
<td>Park or block alley</td>
<td>1.73</td>
</tr>
<tr class="even">
<td>Park/stand on bicycle path</td>
<td>1.94</td>
</tr>
<tr class="odd">
<td>Smoked/tinted windows parked/standing</td>
<td>1.39</td>
</tr>
</tbody>
</table>
<ol start="2" type="1">
<li></li>
</ol>
<p><strong><em>Notice Level</em></strong></p>
<div class="cell" data-layout-align="default">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>flowchart LR</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>A[VIOL] --&gt; B(Could be paid or unpaid)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>C[DETR] --&gt; B</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>D[SIEZ] --&gt; E(Ticket not paid yet)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>F[FINL] --&gt; E</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>G[DLS] --&gt; E</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
A[VIOL] --&gt; B(Could be paid or unpaid)
C[DETR] --&gt; B
D[SIEZ] --&gt; E(Ticket not paid yet)
F[FINL] --&gt; E
G[DLS] --&gt; E
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p><strong>VIOL</strong>: Notice of violation is sent</p>
<p><strong>SIEZ</strong>: The vehicle is now on the city’s boot list</p>
<p><strong>DETR</strong>: hearing officer found vehicle owner liable for the citation</p>
<p><strong>FINL</strong>: unpaid ticket was sent to collections</p>
<p><strong>DLS</strong>: city intends to seek a license suspension</p>
<p><strong><em>Ticket Queue</em></strong></p>
<div class="cell" data-layout-align="default">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>flowchart LR</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>A[PAID] --&gt; B[No more action needed]</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>C[DISMESSED] --&gt; B</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>D[BANKRUPTCY] --&gt; B</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>E[HEARING REQ] --&gt; F[Waiting for outcome to see if still need to pay]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>G[COURT] --&gt; F</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>H[NOTICE] --&gt; I[Still need to pay ticket]</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>J[DEFINE] --&gt; I</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
A[PAID] --&gt; B[No more action needed]
C[DISMESSED] --&gt; B
D[BANKRUPTCY] --&gt; B
E[HEARING REQ] --&gt; F[Waiting for outcome to see if still need to pay]
G[COURT] --&gt; F
H[NOTICE] --&gt; I[Still need to pay ticket]
J[DEFINE] --&gt; I
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p><strong>PAID</strong>: The ticket was paid</p>
<p><strong>DISMISSED</strong>: The ticket was dismissed</p>
<p><strong>HEARING REQ</strong>: The ticket was contested and awaiting a hearing at the time the data was pulled</p>
<p><strong>NOTICE</strong>: The ticket was not yet paid and the city sent a notice to the address on file for that vehicle</p>
<p><strong>COURT</strong>: The ticket is involved in some sort of court case, not including bankruptcy</p>
<p><strong>BANKRUPTCY</strong>: The ticket was unpaid and included as a debt in a consumer bankruptcy case</p>
<p><strong>DEFINE</strong>: The city cannot identify the vehicle owner and collect on a debt</p>
<ol start="3" type="1">
<li></li>
</ol>
<div id="8e4fba22" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">##original chart with messy legend</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>Final_chart <span class="op">=</span> alt.Chart(q_3_1_df).mark_point(clip<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'paid_tickets'</span>, title<span class="op">=</span><span class="st">'Fraction of Tickets that Are Paid'</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'avg_level1_fine'</span>, title<span class="op">=</span><span class="st">'Average Level 1 Fine'</span>).scale(domain<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">275</span>)),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'violation_description:N'</span>, title<span class="op">=</span><span class="st">'Violation Description'</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>Final_chart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-39-output-1.png" width="543" height="503" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="ace52bd4" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">##find the 'ticket_count' cutoff for the 10 most common</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q_3_1_df.sort_values(by<span class="op">=</span>[<span class="st">'ticket_count'</span>], ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">11</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">##dfine the function to categorize based on ticket_count</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_violation(row):</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'ticket_count'</span>] <span class="op">&gt;</span> <span class="dv">10000</span>:</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> row[<span class="st">'violation_description'</span>]</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'OTHER'</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co">##apply the function to create the '10_most_common' column</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>q_3_1_df[<span class="st">'10_most_common'</span>] <span class="op">=</span> q_3_1_df.<span class="bu">apply</span>(categorize_violation, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                 violation_description  paid_tickets  \
23            EXPIRED PLATES OR TEMPORARY REGISTRATION      0.604361   
101                                    STREET CLEANING      0.811612   
90                          RESIDENTIAL PERMIT PARKING      0.742262   
19            EXP. METER NON-CENTRAL BUSINESS DISTRICT      0.792913   
81                 PARKING/STANDING PROHIBITED ANYTIME      0.705817   
21                           EXPIRED METER OR OVERSTAY      0.806355   
85                       REAR AND FRONT PLATE REQUIRED      0.530482   
43   NO CITY STICKER VEHICLE UNDER/EQUAL TO 16,000 ...      0.398357   
91                                   RUSH HOUR PARKING      0.770414   
41                 NO CITY STICKER OR IMPROPER DISPLAY      0.543303   
20             EXPIRED METER CENTRAL BUSINESS DISTRICT      0.741680   

     avg_level1_fine  ticket_count  
23         54.968869         44811  
101        54.004249         28712  
90         66.338302         23683  
19         46.598058         20600  
81         66.142864         19753  
21         50.000000         18756  
85         54.610525         15829  
43        200.000000         14246  
91         68.209779         11965  
41        120.000000         10773  
20         62.608361          9736  </code></pre>
</div>
</div>
<div id="a8074475" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">##second chart with ten most commonly used violation descriptions</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>Final_chart_part_2 <span class="op">=</span> alt.Chart(q_3_1_df).mark_point(clip<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'paid_tickets'</span>, title<span class="op">=</span><span class="st">'Fraction of Tickets that Are Paid'</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'avg_level1_fine'</span>, title<span class="op">=</span><span class="st">'Average Level 1 Fine'</span>).scale(domain<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">275</span>)),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'10_most_common:N'</span>, title<span class="op">=</span><span class="st">'Violation Description'</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>Final_chart_part_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-41-output-1.png" width="543" height="342" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="014b0f4f" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#organize into categories</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_violation_description(row):</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    description <span class="op">=</span> row[<span class="st">'violation_description'</span>]</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'EXPIRED'</span> <span class="kw">in</span> description:</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'EXPIRED'</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'PLATE'</span> <span class="kw">in</span> description:</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'LICENSE PLATE'</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'SNOW'</span> <span class="kw">in</span> description:</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'SNOW'</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'SAFETY BELT'</span> <span class="kw">in</span> description:</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'SEAT BELT'</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">any</span>(keyword <span class="kw">in</span> description <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">'CITY STICKER'</span>, <span class="st">'PERMIT'</span>, <span class="st">'PLACARD'</span>, <span class="st">'IDENTIFICATION'</span>]):</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'CITY STICKER OR PERMIT'</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">any</span>(keyword <span class="kw">in</span> description <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">'TRUCK'</span>, <span class="st">'DIESEL'</span>]):</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'TRUCK'</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">any</span>(keyword <span class="kw">in</span> description <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">'HAZARDOUS'</span>, <span class="st">'UNSAFE'</span>]):</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'HAZARDOUS'</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">any</span>(keyword <span class="kw">in</span> description <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">'LAMP'</span>, <span class="st">'REFLECTORS'</span>, <span class="st">'LAMPS'</span>, <span class="st">'LIGHTS'</span>, <span class="st">'WINDOWS'</span>, <span class="st">'BRAKES'</span>, <span class="st">'EXCESS'</span>, <span class="st">'REAR'</span>, <span class="st">'LOAD'</span>, <span class="st">'HORN'</span>, <span class="st">'SIREN'</span>, <span class="st">'ALARM'</span> <span class="st">'IMPROPER'</span>]):</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'CAR NEEDS REPAIR'</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">any</span>(keyword <span class="kw">in</span> description <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">'PARK'</span>, <span class="st">'OBSTRUCT'</span>, <span class="st">'PARKING'</span>, <span class="st">'ENTRANCE'</span>, <span class="st">'BLOCK'</span>, <span class="st">'WITHIN'</span>, <span class="st">'CURB'</span>, <span class="st">'UNDER'</span>, <span class="st">'OUTSIDE'</span>, <span class="st">'STREET'</span>, <span class="st">'SPECIAL'</span>, <span class="st">'METER'</span>]):</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'PARKING'</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'OTHER'</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to create the 'categories' column</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>q_3_1_df[<span class="st">'categories'</span>] <span class="op">=</span> q_3_1_df.<span class="bu">apply</span>(categorize_violation_description, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c8e46314" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">##second chart with ten most commonly used violation descriptions</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>Final_chart_really <span class="op">=</span> alt.Chart(q_3_1_df).mark_point(clip<span class="op">=</span><span class="va">True</span>).encode(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    alt.X(<span class="st">'paid_tickets'</span>, title<span class="op">=</span><span class="st">'Fraction of Tickets that Are Paid'</span>),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    alt.Y(<span class="st">'avg_level1_fine'</span>, title<span class="op">=</span><span class="st">'Average Level 1 Fine'</span>).scale(domain<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">275</span>)),</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    alt.Color(<span class="st">'categories:N'</span>, title<span class="op">=</span><span class="st">'Violation Description'</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>Final_chart_really</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-43-output-1.png" width="511" height="342" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="extra-credit-max-5-points" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit-max-5-points">Extra Credit (max 5 points)</h2>
<ol type="1">
<li></li>
<li></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>